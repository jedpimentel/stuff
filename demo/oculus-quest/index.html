<!DOCTYPE html>
<html lang="eng">

<head>
  <title>Jose Quest</title>
  <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
  <script src="../../lib/jose-components.js"></script>
  <meta charset="utf-8">
</head>

<body style="font-family:courier; color:white; background-color: black">

  <audio id='audio-clip'>
    <source src="../../placeholder.flac" type='audio/flac' />
  </audio>
  <script type="text/javascript">
  	AFRAME.registerComponent('debug-menu', {
  		init: function() {
  			console.log('initting...', this)
  			this.line_y = 0
  			this.log = function(val) {
	  			console.log(val)
	  			const text = document.createElement('a-text')
	  			text.setAttribute('value', val)
	  			this.line_y -= 0.2
	  			text.setAttribute('position', `0 ${this.line_y} 0`)
	  			this.el.appendChild(text)
	  		}
	  		// this.log('test')


        // const debug_menu = this
        document.addEventListener('debug-menu-log', (e) => {
          // this.log(e.detail.text)
          this.log('space')
          this.log(JSON.stringify(e.detail))
        })

	  	}
  	})

    AFRAME.registerComponent('hand-controller', {
      schema: {
        side: {type: 'string', default: 'left'},
      },
      init: function() {
        // anchor position gets dropped when movement mode is activated

        this._movement_anchor = document.createElement('a-sphere');
        this._movement_anchor.setAttribute('color', 'white');
        this._movement_anchor.setAttribute('radius', '0.05');
        this.el.parentEl.appendChild(this._movement_anchor)
        // console.log('this is', this)


        // this.anchor = new THREE.Vector3()
        this.anchor = this._movement_anchor.object3D.position;
        this.moving = false;

        this.log = function(a) {
          let evt = new CustomEvent('debug-menu-log', {
            detail: {
              // text: e.detail
              text: a
            }
          })
          document.dispatchEvent(evt)
        }

        document.addEventListener('gripdown', (e) => {
          this.log(this.el.object3D.position)

          this._movement_anchor.object3D.position.x = this.el.object3D.position.x
          this._movement_anchor.object3D.position.y = this.el.object3D.position.y
          this._movement_anchor.object3D.position.z = this.el.object3D.position.z

          this.moving = this._movement_anchor.object3D.visible = true
        })

        document.addEventListener('gripup', (e) => {
          this.moving = this._movement_anchor.object3D.visible = false
        })

      },
      tick: function() {
        if(this.moving) {

          camera_wrapper = document.getElementById("camera-wrapper");
          camera_wrapper.object3D.position.x += this.el.object3D.position.x - this.anchor.x;
          // camera_wrapper.object3D.position.y += this.el.object3D.position.y - this.anchor.y;
          camera_wrapper.object3D.position.z += this.el.object3D.position.z - this.anchor.z;
        }

      }
    });
    
  </script>


	<a-scene loading-screen="dotsColor: white; backgroundColor: black">

    <a-assets>
      <img id="lamb" src="../../lamb.png">
    </a-assets>

    <a-entity id="camera-wrapper">
      <a-camera look-controls="pointerLockEnabled: true" near="0.001">

          <a-text opacity="0.1" value="frames-per-second" width="0.8" position="0.2 -0.3 -0.9"></a-text>
          <a-text opacity="0.1" fps-counter position="0.2 -0.4 -0.9"></a-text>

          <a-cylinder id="fing-longer" position="0.2 -0.4 -0.9" radius="0.01" height= "1.0" rotation="90 0 0" color="beige" opacity="1.0"></a-cylinder>
          <!-- <a-box  position="0.2 -0.4 -0.9" height="0.2" width="0.2" depth="0.2"></a-box> -->
          <!-- <a-entity position="0.2 -0.4 -1.4" cursor="rayOrigin: entity; showLine: true;" raycaster="showLine: true; far: 16" line="color: white; opacity:0.5"></a-entity> -->

          <!-- <a-entity cursor-debug id="cursor" position="0.2 -0.4 -1.4" cursor raycaster="objects:.clickable; showLine: true; far: 16" line="color: white; opacity:0.5"></a-entity> -->
      </a-camera>

      <a-entity laser-controls="hand: left" grip-to-move="targetID: camera-wrapper" raycaster="objects:.clickable; far:4">
        <a-box  height="0.1" width="0.1" depth="0.1" opacity="0.2"></a-box>
      </a-entity>
      <!-- <a-entity laser-controls="hand: left" hand-controller raycaster="objects:.clickable; far:4">
        <a-box  height="0.1" width="0.1" depth="0.1" opacity="0.2"></a-box>
      </a-entity> -->

      <a-entity laser-controls="hand: right" hand-controller raycaster="objects:.clickable; far:4">
        <a-box  height="0.1" width="0.1" depth="0.1" opacity="0.2"></a-box>
      </a-entity>

    </a-entity>


    

		<a-cylinder id='green-cyl' position="5 0.75 -8" radius="0.5" color="green" opacity="0.3"></a-cylinder>
    <a-cylinder id='click-ball' position="6.5 .75 -8" radius="0.5" color="green" opacity="0.3"></a-cylinder>


    <a-text position="8 4 -8" value="Click on these link to go to other sites. 'Stuff' is a room with a few things to click on. 'A-Painter' is a drawing appp by Mozilla. 'Baltri' is a weird art thing I'm doing with some friends from DR."></a-text>

    <a-link class="clickable" position="5 1 -8" href="#" title="refresh" image="#lamb"></a-link>

    <a-link class="clickable" position="8 1 -8" href="../../" title="Stuff" image="#lamb"></a-link>
    <!-- <a-link class="clickable" position="8 1 -8" href="../../" title="Stuff" image="#lamb" border-color="blue"></a-link> -->

    <a-link class="clickable" position="11 1 -8" href="https://aframe.io/a-painter/" title="A Painter\n" image="#lamb"></a-link>

    <a-link link-controls id="baltri" title-color="red" class="clickable" position="14 1 -8" href="http://baltri.com" title="Baltri" image="#lamb"></a-link>

    <a-text position="-10 4 -6" value="Placed like this, you can literally walk into a 360 image. (note to self: find a 360 image worth showing off)"></a-text>
    <a-sky src="#lamb" radius="2" position="-7.5 1 -6"></a-sky>



		<a-entity	debug-menu position="-4 8 -9.5">
			<a-text value="DEBUG MENU"></a-text>
		</a-entity>
    <a-text position="-4 3 -7" font='monoid' width="8" side="double" wrap-count="80" value="

#                              ----JOSE-QUEST----                              #

Welcome traveler.
"
    ></a-text>

		<a-entity id="blob"></a-entity>

    <!-- auto-go thing is a pretty bad bug -->
    <!-- <a-entity> -->
    <!-- <a-box></a-box> -->
    <!-- </a-entity> -->
    <!-- <a-entity position="8 1 -8" link="href: https://jedpimentel.github.io/stuff/; title: Main; image: #lamb"></a-entity> -->
	</a-scene>


	<script type="text/javascript">{
		// play audio on cylinder click 
		{
			let cyl = document.querySelector('#green-cyl');
			let audio = document.querySelector('#audio-clip');

			let paused_opacity = cyl.getAttribute('opacity');
			let playing_opacity = 0.4;

			cyl.addEventListener('click', function (evt) {
				cyl.setAttribute('opacity', playing_opacity)
				audio.currentTime = 0;
				audio.play();
			});
			audio.addEventListener('ended', () => {
				cyl.setAttribute('opacity', paused_opacity)
			});
		}

    // make a floor and a wall
    {

      const BLOB = document.querySelector('#blob');
      class Sphere {
        constructor(config={}) {
          this.element = document.createElement(config.element || 'a-sphere')
          this.element.setAttribute('color', config.color || 'white');
          this.element.setAttribute('radius', '0.01');
          this.element.setAttribute('material', "shader: flat")
          this.element.setAttribute('type', "point")

          this.element.setAttribute('position', `${config.pos_x} ${config.pos_y} ${config.pos_z}`);
          BLOB.appendChild(this.element)
        }
      }
      class Marker extends Sphere {
        // this is just a convenience thing
        constructor(x, y, z) {
          super({pos_x:x, pos_y:y, pos_z:z})
        }
      }
      // floor
      for (let i = -10; i <= 10; i++) {
        // for (let j = -10; j <= 10; j++) {
          for (let k = -10; k <= 10; k++) {
            new Marker(i, 0, k)
          }
        // }
      }
      // wall
      for (let i = -4; i <= 4; i++) {
        for (let j = 1; j <= 8; j++) {
          // for (let k = -10; k <= 10; k++) {
            new Marker(i, j, -10)
          // }
        }
      }
    }


            
    // document.addEventListener('load', function(){ 
    //   console.log('aaaaaaaaa')
    //   let a = document.querySelector('#cursor')
    //   console.log(a)
    // }, false);
	}</script>
</body>

</html>